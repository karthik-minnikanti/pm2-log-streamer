<!DOCTYPE html>
<html>

<head>
    <title>PM2 Logs</title>
</head>

<body>
    <h1>PM2 Logs</h1>
    <pre id="logs"></pre>
    <script>
        async function fetchConfig() {
            const response = await fetch('/config');
            if (!response.ok) {
                throw new Error('Failed to load configuration');
            }
            return await response.json();
        }

        async function initWebSocket() {
            try {
                const config = await fetchConfig();
                const ws = new WebSocket(config.websocket_url);
                const logs = document.getElementById('logs');

                ws.onmessage = (event) => {
                    logs.textContent += event.data + '\n';
                };
            } catch (error) {
                console.error('Failed to initialize WebSocket', error);
            }
        }

        initWebSocket();
    </script>
</body>

</html>